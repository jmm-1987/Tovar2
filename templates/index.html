{% extends "base.html" %}

{% block title %}Panel de Control - Gestión de Pedidos{% endblock %}

{% block content %}
<div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
    <h2 style="font-size: 1.5rem; margin: 0;">PANEL DE CONTROL</h2>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="{{ url_for('nuevo_presupuesto') }}" class="btn btn-primary" style="padding: 8px 16px; font-size: 0.85rem;">Nuevo Presupuesto</a>
        <a href="{{ url_for('nuevo_pedido') }}" class="btn btn-success" style="padding: 8px 16px; font-size: 0.85rem;">Nuevo Pedido</a>
    </div>
</div>

{% if pedidos %}
<div class="pedidos-grid">
    {% for pedido in pedidos %}
    <div class="pedido-card {% if pedido.fecha_class %}pedido-{{ pedido.fecha_class }}{% endif %}">
        <div class="pedido-card-header">
            <div class="pedido-id">
                Pedido #{{ pedido.id }}{% if pedido.fecha_aceptacion %} - {{ pedido.fecha_aceptacion.strftime('%d/%m/%Y') }}{% endif %}
            </div>
            <span class="badge badge-estado-{{ pedido.estado.lower()|replace(' ', '-')|replace('ó', 'o')|replace('í', 'i')|replace('é', 'e') }}">{{ pedido.estado }}</span>
        </div>
        
        <div class="pedido-card-body">
            <div class="pedido-info-item">
                <strong>Cliente:</strong>
                <span>{{ pedido.cliente.nombre if pedido.cliente else 'N/A' }}</span>
            </div>
            
            <div class="pedido-info-item">
                <strong>Tipo:</strong>
                <span>{{ pedido.tipo_pedido }}</span>
            </div>
            
            <div class="pedido-info-item">
                <strong>Fecha Objetivo:</strong>
                <span>
                    {% if pedido.fecha_objetivo %}
                        <span class="fecha-objetivo {{ pedido.fecha_class }}">
                            {{ pedido.fecha_objetivo.strftime('%d/%m/%Y') }}
                        </span>
                    {% else %}
                        -
                    {% endif %}
                </span>
            </div>
            
            {% if pedido.lineas %}
            <div class="pedido-lineas-container">
                <strong>Líneas del Pedido:</strong>
                <ul class="pedido-lineas-list">
                    {% for linea in pedido.lineas %}
                    <li class="linea-item">
                        <span class="linea-nombre">{{ linea.nombre }}</span>
                        <span class="badge badge-estado-linea badge-estado-{{ linea.estado.lower()|replace(' ', '-')|replace('ó', 'o')|replace('í', 'i')|replace('é', 'e') }}">{{ linea.estado }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
        
        <div class="pedido-card-actions">
            <a href="{{ url_for('ver_pedido', pedido_id=pedido.id) }}" class="btn btn-info">Ver</a>
            <a href="{{ url_for('imprimir_pedido', pedido_id=pedido.id) }}" class="btn btn-warning" target="_blank">Imprimir</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p>No hay pedidos registrados. <a href="{{ url_for('nuevo_pedido') }}">Crear primer pedido</a></p>
{% endif %}
{% endblock %}
