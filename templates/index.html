{% extends "base.html" %}

{% block title %}Panel de Control - Gestión de Pedidos{% endblock %}

{% block content %}
<div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
    <h2 style="font-size: 1.5rem; margin: 0;">PANEL DE CONTROL</h2>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="{{ url_for('solicitudes.nueva_solicitud') }}" class="btn btn-primary" style="padding: 8px 16px; font-size: 0.85rem;">Nueva Solicitud</a>
    </div>
</div>

{% if solicitudes %}
<div class="pedidos-grid">
    {% for solicitud in solicitudes %}
    <div class="pedido-card {% if solicitud.fecha_class %}pedido-{{ solicitud.fecha_class }}{% endif %}">
        <div class="pedido-card-header">
            <div class="pedido-id">
                Solicitud #{{ solicitud.id }}{% if solicitud.fecha_aceptado %} - {{ solicitud.fecha_aceptado.strftime('%d/%m/%Y') }}{% endif %}
            </div>
            <span class="badge badge-estado-{{ solicitud.estado|lower|replace(' ', '-') }}">{{ solicitud.estado|title }}</span>
        </div>
        
        <div class="pedido-card-body">
            <div class="pedido-info-item">
                <strong>Cliente:</strong>
                <span>{{ solicitud.cliente.nombre if solicitud.cliente else 'N/A' }}</span>
            </div>
            
            <div class="pedido-info-item">
                <strong>Tipo:</strong>
                <span>{{ solicitud.tipo_pedido|title }}</span>
            </div>
            
            <div class="pedido-info-item">
                <strong>Fecha Objetivo:</strong>
                <span>
                    {% if solicitud.fecha_objetivo %}
                        <span class="fecha-objetivo {{ solicitud.fecha_class }}">
                            {{ solicitud.fecha_objetivo.strftime('%d/%m/%Y') }}
                        </span>
                    {% else %}
                        -
                    {% endif %}
                </span>
            </div>
            
            {% if solicitud.lineas %}
            <div class="pedido-lineas-container">
                <strong>Líneas de la Solicitud:</strong>
                <ul class="pedido-lineas-list">
                    {% for linea in solicitud.lineas %}
                    <li class="linea-item">
                        <span class="linea-nombre">{{ linea.prenda.nombre if linea.prenda else 'N/A' }}</span>
                        <span class="badge badge-estado-linea badge-estado-{{ linea.estado|lower|replace(' ', '-') }}">{{ linea.estado|title }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
        
        <div class="pedido-card-actions">
            <a href="{{ url_for('solicitudes.ver_solicitud', solicitud_id=solicitud.id) }}" class="btn btn-info">Ver</a>
            <a href="{{ url_for('solicitudes.descargar_pdf_solicitud', solicitud_id=solicitud.id) }}" class="btn btn-warning" target="_blank">Imprimir</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p>No hay solicitudes activas. <a href="{{ url_for('solicitudes.nueva_solicitud') }}">Crear primera solicitud</a></p>
{% endif %}
{% endblock %}
