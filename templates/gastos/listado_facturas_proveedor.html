{% extends "base.html" %}

{% block title %}Facturas de Proveedor - Gastos{% endblock %}

{% block content %}
<div class="clientes-container">
    <div class="clientes-header">
        <h2>Facturas de Proveedor</h2>
        <a href="{{ url_for('gastos.nueva_factura_proveedor') }}" class="btn btn-success">‚ûï Nueva Factura</a>
    </div>

    <div style="margin-bottom: 25px;">
        <div class="filtros-container" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e9ecef;">
            <form method="GET" action="{{ url_for('gastos.listado_facturas_proveedor') }}" style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                <div class="filtro-group" style="display: flex; flex-direction: column; flex: 1; min-width: 180px;">
                    <label for="estado" style="font-size: 0.875rem; font-weight: 600; color: #495057; margin-bottom: 6px; display: flex; align-items: center; gap: 6px;">
                        <span>üè∑Ô∏è</span> Estado
                    </label>
                    <select name="estado" id="estado" class="filtro-input" style="padding: 10px 14px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 0.9rem; background: white; color: #495057; transition: all 0.3s ease; cursor: pointer;">
                        <option value="">Todos los estados</option>
                        {% for estado in estados %}
                        <option value="{{ estado }}" {% if estado_filtro == estado %}selected{% endif %}>{{ estado|title }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="filtro-group" style="display: flex; flex-direction: column; flex: 1; min-width: 180px;">
                    <label for="fecha_desde" style="font-size: 0.875rem; font-weight: 600; color: #495057; margin-bottom: 6px; display: flex; align-items: center; gap: 6px;">
                        <span>üìÖ</span> Fecha Desde
                    </label>
                    <input type="date" name="fecha_desde" id="fecha_desde" value="{{ fecha_desde }}" class="filtro-input" style="padding: 10px 14px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 0.9rem; background: white; color: #495057; transition: all 0.3s ease;">
                </div>
                
                <div class="filtro-group" style="display: flex; flex-direction: column; flex: 1; min-width: 180px;">
                    <label for="fecha_hasta" style="font-size: 0.875rem; font-weight: 600; color: #495057; margin-bottom: 6px; display: flex; align-items: center; gap: 6px;">
                        <span>üìÖ</span> Fecha Hasta
                    </label>
                    <input type="date" name="fecha_hasta" id="fecha_hasta" value="{{ fecha_hasta }}" class="filtro-input" style="padding: 10px 14px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 0.9rem; background: white; color: #495057; transition: all 0.3s ease;">
                </div>
                
                <div style="display: flex; gap: 10px; align-items: flex-end;">
                    <button type="submit" class="btn btn-primary" style="padding: 10px 20px; border-radius: 8px; font-weight: 600; box-shadow: 0 2px 4px rgba(0,123,255,0.3); transition: all 0.3s ease;">
                        üîç Filtrar
                    </button>
                    {% if estado_filtro or fecha_desde or fecha_hasta %}
                    <a href="{{ url_for('gastos.listado_facturas_proveedor') }}" class="btn btn-secondary" style="padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;">
                        üóëÔ∏è Limpiar
                    </a>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>

    <style>
    .filtro-input:hover {
        border-color: #adb5bd !important;
        box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
    }

    .filtro-input:focus {
        outline: none;
        border-color: #007bff !important;
        box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
    }

    select.filtro-input {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23495057' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 35px !important;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
    }

    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,123,255,0.4) !important;
    }

    .btn-secondary:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(108,117,125,0.3);
    }
    </style>

    {% if facturas %}
    <div class="table-container">
        <table class="clientes-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Proveedor</th>
                    <th>N√∫mero Factura</th>
                    <th>Fecha</th>
                    <th>Base Imponible</th>
                    <th>IVA</th>
                    <th>Total</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for factura in facturas %}
                <tr>
                    <td>{{ factura.id }}</td>
                    <td>{{ factura.proveedor.nombre if factura.proveedor else 'N/A' }}</td>
                    <td>{{ factura.numero_factura }}</td>
                    <td>{{ factura.fecha_factura.strftime('%d/%m/%Y') if factura.fecha_factura else '-' }}</td>
                    <td>{{ "%.2f"|format(factura.base_imponible) }} ‚Ç¨</td>
                    <td>{{ "%.2f"|format(factura.importe_iva) }} ‚Ç¨ ({{ "%.0f"|format(factura.tipo_iva) }}%)</td>
                    <td><strong>{{ "%.2f"|format(factura.total) }} ‚Ç¨</strong></td>
                    <td>
                        <span class="badge badge-{{ 'success' if factura.estado == 'pagada' else 'warning' if factura.estado == 'pendiente' else 'danger' }}">
                            {{ factura.estado|title }}
                        </span>
                    </td>
                    <td class="acciones-cell">
                        <a href="{{ url_for('gastos.editar_factura_proveedor', factura_id=factura.id) }}" class="btn btn-sm btn-primary">Editar</a>
                        <form method="POST" action="{{ url_for('gastos.eliminar_factura_proveedor', factura_id=factura.id) }}" style="display: inline;" onsubmit="return confirm('¬øEst√° seguro de eliminar esta factura?');">
                            <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="no-data">
        <p>No hay facturas de proveedor registradas.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

