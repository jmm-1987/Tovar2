{% extends "base.html" %}

{% block title %}N√≥minas - Gastos{% endblock %}

{% block content %}
<div class="clientes-container">
    <div class="clientes-header">
        <h2>N√≥minas</h2>
        <a href="{{ url_for('gastos.nueva_nomina') }}" class="btn btn-success">‚ûï Nueva N√≥mina</a>
    </div>

    <div style="margin-bottom: 25px;">
        <div class="filtros-container" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e9ecef;">
            <form method="GET" action="{{ url_for('gastos.listado_nominas') }}" style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                <div class="filtro-group" style="display: flex; flex-direction: column; flex: 1; min-width: 150px;">
                    <label for="a√±o_desde" style="font-size: 0.875rem; font-weight: 600; color: #495057; margin-bottom: 6px; display: flex; align-items: center; gap: 6px;">
                        <span>üìÖ</span> A√±o Desde
                    </label>
                    <select name="a√±o_desde" id="a√±o_desde" class="filtro-input" style="padding: 10px 14px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 0.9rem; background: white; color: #495057; transition: all 0.3s ease; cursor: pointer;">
                        <option value="">Todos</option>
                        {% for a√±o in a√±os %}
                        <option value="{{ a√±o }}" {% if a√±o_desde|string == a√±o|string %}selected{% endif %}>{{ a√±o }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="filtro-group" style="display: flex; flex-direction: column; flex: 1; min-width: 150px;">
                    <label for="mes_desde" style="font-size: 0.875rem; font-weight: 600; color: #495057; margin-bottom: 6px; display: flex; align-items: center; gap: 6px;">
                        <span>üìÜ</span> Mes Desde
                    </label>
                    <select name="mes_desde" id="mes_desde" class="filtro-input" style="padding: 10px 14px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 0.9rem; background: white; color: #495057; transition: all 0.3s ease; cursor: pointer;">
                        <option value="">Todos</option>
                        {% set meses_nombres = ['', 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'] %}
                        {% for i in range(1, 13) %}
                        <option value="{{ i }}" {% if mes_desde == i|string %}selected{% endif %}>{{ meses_nombres[i] }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="filtro-group" style="display: flex; flex-direction: column; flex: 1; min-width: 150px;">
                    <label for="a√±o_hasta" style="font-size: 0.875rem; font-weight: 600; color: #495057; margin-bottom: 6px; display: flex; align-items: center; gap: 6px;">
                        <span>üìÖ</span> A√±o Hasta
                    </label>
                    <select name="a√±o_hasta" id="a√±o_hasta" class="filtro-input" style="padding: 10px 14px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 0.9rem; background: white; color: #495057; transition: all 0.3s ease; cursor: pointer;">
                        <option value="">Todos</option>
                        {% for a√±o in a√±os %}
                        <option value="{{ a√±o }}" {% if a√±o_hasta|string == a√±o|string %}selected{% endif %}>{{ a√±o }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="filtro-group" style="display: flex; flex-direction: column; flex: 1; min-width: 150px;">
                    <label for="mes_hasta" style="font-size: 0.875rem; font-weight: 600; color: #495057; margin-bottom: 6px; display: flex; align-items: center; gap: 6px;">
                        <span>üìÜ</span> Mes Hasta
                    </label>
                    <select name="mes_hasta" id="mes_hasta" class="filtro-input" style="padding: 10px 14px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 0.9rem; background: white; color: #495057; transition: all 0.3s ease; cursor: pointer;">
                        <option value="">Todos</option>
                        {% for i in range(1, 13) %}
                        <option value="{{ i }}" {% if mes_hasta == i|string %}selected{% endif %}>{{ meses_nombres[i] }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div style="display: flex; gap: 10px; align-items: flex-end;">
                    <button type="submit" class="btn btn-primary" style="padding: 10px 20px; border-radius: 8px; font-weight: 600; box-shadow: 0 2px 4px rgba(0,123,255,0.3); transition: all 0.3s ease;">
                        üîç Filtrar
                    </button>
                    {% if a√±o_desde or mes_desde or a√±o_hasta or mes_hasta %}
                    <a href="{{ url_for('gastos.listado_nominas') }}" class="btn btn-secondary" style="padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;">
                        üóëÔ∏è Limpiar
                    </a>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>

    <style>
    .filtro-input:hover {
        border-color: #adb5bd !important;
        box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
    }

    .filtro-input:focus {
        outline: none;
        border-color: #007bff !important;
        box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
    }

    select.filtro-input {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23495057' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 35px !important;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
    }

    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,123,255,0.4) !important;
    }

    .btn-secondary:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(108,117,125,0.3);
    }
    </style>

    {% if nominas %}
    <div class="table-container">
        <table class="clientes-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Empleado</th>
                    <th>Mes</th>
                    <th>A√±o</th>
                    <th>Total Devengado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for nomina in nominas %}
                <tr>
                    <td>{{ nomina.id }}</td>
                    <td>{{ nomina.empleado.nombre if nomina.empleado else 'N/A' }}</td>
                    <td>
                        {% set meses = ['', 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'] %}
                        {{ meses[nomina.mes] }}
                    </td>
                    <td>{{ nomina.a√±o }}</td>
                    <td><strong>{{ "%.2f"|format(nomina.total_devengado) }} ‚Ç¨</strong></td>
                    <td class="acciones-cell">
                        <a href="{{ url_for('gastos.editar_nomina', nomina_id=nomina.id) }}" class="btn btn-sm btn-primary">Editar</a>
                        <form method="POST" action="{{ url_for('gastos.eliminar_nomina', nomina_id=nomina.id) }}" style="display: inline;" onsubmit="return confirm('¬øEst√° seguro de eliminar esta n√≥mina?');">
                            <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="no-data">
        <p>No hay n√≥minas registradas.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

