<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Gesti√≥n de Pedidos{% endblock %}</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='fav.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <div class="container header-wrapper">
            <a href="{{ url_for('index.index') }}" style="text-decoration: none; display: flex; align-items: center;">
                <img src="{{ url_for('static', filename='logo_base.png') }}" alt="Logo" class="header-logo">
            </a>
            <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav id="mainNav">
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('index.index') }}">PANEL DE CONTROL</a>
                    {% if current_user.rol == 'usuario' %}
                        {# Usuarios con rol "usuario" solo ven Panel de Control y Solicitudes #}
                        <a href="{{ url_for('solicitudes.listado_solicitudes') }}">SOLICITUDES</a>
                    {% else %}
                        {# Otros usuarios ven el men√∫ completo #}
                        <div class="dropdown">
                            <a href="#" class="dropdown-toggle">üí∞ Ventas <span class="dropdown-arrow">‚ñº</span></a>
                            <div class="dropdown-menu">
                                <a href="{{ url_for('solicitudes.listado_solicitudes') }}">Solicitudes</a>
                                <a href="{{ url_for('facturacion.facturacion') }}">Facturaci√≥n</a>
                                <a href="{{ url_for('clientes.gestion_clientes') }}">Clientes</a>
                                <a href="{{ url_for('prendas.gestion_prendas') }}">Productos</a>
                            </div>
                        </div>
                        <div class="dropdown">
                            <a href="#" class="dropdown-toggle">üõí Tickets Tienda <span class="dropdown-arrow">‚ñº</span></a>
                            <div class="dropdown-menu">
                                <a href="{{ url_for('tickets.listado_tickets') }}">Tickets</a>
                                <a href="{{ url_for('tickets.listado_clientes_tienda') }}">Clientes de Tienda</a>
                                <a href="{{ url_for('tickets.cuadre_caja') }}">Cuadre de Caja</a>
                            </div>
                        </div>
                        <div class="dropdown">
                            <a href="#" class="dropdown-toggle">üìä Informes <span class="dropdown-arrow">‚ñº</span></a>
                            <div class="dropdown-menu">
                                <a href="{{ url_for('informes.facturacion_emitida') }}">Facturaci√≥n Emitida</a>
                                <a href="{{ url_for('informes.facturacion_soportada') }}">Facturaci√≥n Soportada</a>
                                <a href="{{ url_for('informes.nominas') }}">N√≥minas</a>
                                <a href="{{ url_for('informes.iva') }}">IVA</a>
                            </div>
                        </div>
                        <div class="dropdown">
                            <a href="#" class="dropdown-toggle">üí∞ Gastos <span class="dropdown-arrow">‚ñº</span></a>
                            <div class="dropdown-menu">
                                <a href="{{ url_for('gastos.listado_proveedores') }}">Proveedores</a>
                                <a href="{{ url_for('gastos.listado_facturas_proveedor') }}">Facturas Proveedor</a>
                                <a href="{{ url_for('gastos.listado_empleados') }}">Empleados</a>
                                <a href="{{ url_for('gastos.listado_nominas') }}">N√≥minas</a>
                            </div>
                        </div>
                        {% if current_user.is_supervisor() %}
                            <a href="{{ url_for('configuracion.index') }}">‚öôÔ∏è Configuraci√≥n</a>
                        {% endif %}
                    {% endif %}
                    <div class="user-menu">
                        <span class="user-name">{{ current_user.usuario }}</span>
                        <a href="{{ url_for('auth.logout') }}" class="logout-btn-circle" title="Cerrar Sesi√≥n">
                            <img src="{{ url_for('static', filename='logo_jm.png') }}" alt="Cerrar Sesi√≥n" style="width: 100%; height: 100%; object-fit: contain;">
                        </a>
                    </div>
                {% endif %}
            </nav>
        </div>
    </header>

    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>
    <script>
        // Toggle del men√∫ hamburguesa
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.getElementById('menuToggle');
            const mainNav = document.getElementById('mainNav');
            const body = document.body;
            
            if (menuToggle && mainNav) {
                function toggleMenu() {
                    mainNav.classList.toggle('nav-open');
                    menuToggle.classList.toggle('active');
                    body.classList.toggle('nav-open');
                }
                
                menuToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleMenu();
                });
                
                // Cerrar el men√∫ al hacer clic en el overlay
                body.addEventListener('click', function(e) {
                    if (body.classList.contains('nav-open')) {
                        const isClickInsideNav = mainNav.contains(e.target);
                        const isClickOnToggle = menuToggle.contains(e.target);
                        
                        if (!isClickInsideNav && !isClickOnToggle) {
                            toggleMenu();
                        }
                    }
                });
                
                // Manejar dropdowns en m√≥viles (toggle al hacer clic)
                const dropdownToggles = mainNav.querySelectorAll('.dropdown-toggle');
                dropdownToggles.forEach(function(toggle) {
                    toggle.addEventListener('click', function(e) {
                        if (window.innerWidth <= 768) {
                            e.preventDefault();
                            e.stopPropagation();
                            const dropdown = this.closest('.dropdown');
                            dropdown.classList.toggle('active');
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>
